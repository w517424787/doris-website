"use strict";(self.webpackChunkselectdb_portal=self.webpackChunkselectdb_portal||[]).push([[19229],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>f});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),d=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=d(a),u=n,f=c["".concat(s,".").concat(u)]||c[u]||m[u]||o;return a?r.createElement(f,l(l({ref:t},p),{},{components:a})):r.createElement(f,l({ref:t},p))}));function f(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:n,l[1]=i;for(var d=2;d<o;d++)l[d]=a[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},35121:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=a(87462),n=(a(67294),a(3905));const o={title:"MySql load",language:"en"},l=void 0,i={unversionedId:"data-operate/import/import-way/mysql-load-manual",id:"version-dev/data-operate/import/import-way/mysql-load-manual",title:"MySql load",description:"\x3c!--",source:"@site/versioned_docs/version-dev/data-operate/import/import-way/mysql-load-manual.md",sourceDirName:"data-operate/import/import-way",slug:"/data-operate/import/import-way/mysql-load-manual",permalink:"/docs/dev/data-operate/import/import-way/mysql-load-manual",draft:!1,editUrl:"https://github.com/apache/doris/edit/master/docs/en/docs/data-operate/import/import-way/mysql-load-manual.md",tags:[],version:"dev",frontMatter:{title:"MySql load",language:"en"},sidebar:"docs",previous:{title:"Stream load",permalink:"/docs/dev/data-operate/import/import-way/stream-load-manual"},next:{title:"S3 Load",permalink:"/docs/dev/data-operate/import/import-way/s3-load-manual"}},s={},d=[{value:"Basic Principles",id:"basic-principles",level:2},{value:"Support data format",id:"support-data-format",level:2},{value:"Basic operations",id:"basic-operations",level:2},{value:"client connection",id:"client-connection",level:3},{value:"Create test table",id:"create-test-table",level:3},{value:"import file from client node",id:"import-file-from-client-node",level:3},{value:"import file from fe server node",id:"import-file-from-fe-server-node",level:3},{value:"Return result",id:"return-result",level:3},{value:"Error result",id:"error-result",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Notice",id:"notice",level:2},{value:"More Help",id:"more-help",level:2}],p={toc:d},c="wrapper";function m(e){let{components:t,...a}=e;return(0,n.kt)(c,(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"mysql-load"},"Mysql load"),(0,n.kt)("version",{since:"dev"},(0,n.kt)("p",null,"This is an stand syntax of MySql ",(0,n.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/load-data.html"},"LOAD DATA")," for user to load local file."),(0,n.kt)("p",null,"MySql load synchronously executes the import and returns the import result. The return information will show whether the import is successful for user."),(0,n.kt)("p",null,"MySql load is mainly suitable for importing local files on the client side, or importing data from a data stream through a program.")),(0,n.kt)("h2",{id:"basic-principles"},"Basic Principles"),(0,n.kt)("p",null,"The MySql Load are similar with Stream Load. Both import local files into the Doris cluster, so the MySQL Load will reuses StreamLoad:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"FE receives the MySQL Load request executed by the client and then analyse the SQL")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"FE build the MySql Load request as a StreamLoad request.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"FE selects a BE node to send a StreamLoad request")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"When sending the request, FE will read the local file data from the MySQL client side streamingly, and send it to the HTTP request of StreamLoad asynchronously.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"After the data transfer on the MySQL client side is completed, FE waits for the StreamLoad to complete, and displays the import success or failure information to the client side."))),(0,n.kt)("h2",{id:"support-data-format"},"Support data format"),(0,n.kt)("p",null,"MySql Load currently only supports data formats: CSV (text)."),(0,n.kt)("h2",{id:"basic-operations"},"Basic operations"),(0,n.kt)("h3",{id:"client-connection"},"client connection"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"mysql --local-infile  -h 127.0.0.1 -P 9030 -u root -D testdb\n")),(0,n.kt)("p",null,"Notice that if you wants to use mysql load, you must connect doris server with ",(0,n.kt)("inlineCode",{parentName:"p"},"--local-infile")," in client command.\nIf you're use jdbc to connect doris, you must add property named ",(0,n.kt)("inlineCode",{parentName:"p"},"allowLoadLocalInfile=true")," in jdbc url."),(0,n.kt)("h3",{id:"create-test-table"},"Create test table"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"}," CREATE TABLE testdb.t1 (pk INT, v1 INT SUM) AGGREGATE KEY (pk) DISTRIBUTED BY hash (pk) PROPERTIES ('replication_num' = '1');\n")),(0,n.kt)("h3",{id:"import-file-from-client-node"},"import file from client node"),(0,n.kt)("p",null," Suppose there is a CSV file named 'client_local.csv 'on the current path of the client side, which will be imported into the test table'testdb.t1' using the MySQL LOAD syntax."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"LOAD DATA LOCAL\nINFILE 'client_local.csv '\nINTO TABLE testdb.t1\nPARTITION (partition_a, partition_b, partition_c, partition_d)\nCOLUMNS TERMINATED BY '\\ t'\nLINES TERMINATED BY '\\ n'\nIGNORE 1 LINES\n(K1, k2, v2, v10, v11)\nSET (c1 = k1, c2 = k2, c3 = v10, c4 = v11)\nPROPERTIES (\"strict_mode\" = \"true\")\n")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"MySQL Load starts with the syntax ",(0,n.kt)("inlineCode",{parentName:"li"},"LOAD DATA"),", and specifying ",(0,n.kt)("inlineCode",{parentName:"li"},"LOCAL")," means reading client side files."),(0,n.kt)("li",{parentName:"ol"},"The local fill path will be filled after ",(0,n.kt)("inlineCode",{parentName:"li"},"INFILE"),", which can be a relative path or an absolute path. Currently only a single file is supported, and multiple files are not supported"),(0,n.kt)("li",{parentName:"ol"},"The table name after ",(0,n.kt)("inlineCode",{parentName:"li"},"INTO TABLE")," can specify the database name, as shown in the case. It can also be omitted, and the current database for the user will be used."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"PARTITION")," syntax supports specified partition to import"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"COLUMNS TERMINATED BY")," specifies the column separator"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"LINES TERMINATED BY")," specifies the line separator"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"IGNORE num LINES")," skips the num header of the CSV."),(0,n.kt)("li",{parentName:"ol"},"Column mapping syntax, see the column mapping chapter of ",(0,n.kt)("a",{parentName:"li",href:"/docs/dev/data-operate/import/import-scenes/load-data-convert"},"Imported Data Transformation")," for specific parameters"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"PROPERTIES")," is the configuration of import, please refer to the ",(0,n.kt)("a",{parentName:"li",href:"/docs/dev/sql-manual/sql-reference/Data-Manipulation-Statements/Load/MYSQL-LOAD"},"MySQL Load")," command manual for specific properties.")),(0,n.kt)("h3",{id:"import-file-from-fe-server-node"},"import file from fe server node"),(0,n.kt)("p",null,"Assuming that the '/root/server_local.csv' path on the FE node is a CSV file, use the MySQL client side to connect to the corresponding FE node, and then execute the following command to import data into the test table."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"LOAD DATA\nINFILE '/root/server_local.csv'\nINTO TABLE testdb.t1\nPARTITION (partition_a, partition_b, partition_c, partition_d)\nCOLUMNS TERMINATED BY '\\ t'\nLINES TERMINATED BY '\\ n'\nIGNORE 1 LINES\n(K1, k2, v2, v10, v11)\nSET (c1 = k1, c2 = k2, c3 = v10, c4 = v11)\nPROPERTIES (\"strict_mode\" = \"true\")\n")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The only difference between the syntax of importing server level local files and importing client side syntax is whether the'LOCAL 'keyword is added after the'LOAD DATA' keyword."),(0,n.kt)("li",{parentName:"ol"},"FE will have multi-nodes, and importing server level files can only import FE nodes connected by the client side, and cannot import files local to other FE nodes."),(0,n.kt)("li",{parentName:"ol"},"Server side load was disabled by default. Enable it by setting ",(0,n.kt)("inlineCode",{parentName:"li"},"mysql_load_server_secure_path")," with a secure path. All the load file should be under this path.")),(0,n.kt)("h3",{id:"return-result"},"Return result"),(0,n.kt)("p",null,"Since MySQL load is a synchronous import method, the imported results are returned to the user through SQL syntax.\nIf the import fails, a specific error message will be displayed. If the import is successful, the number of imported rows will be displayed."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-Text"},"Query OK, 1 row affected (0.17 sec)\nRecords: 1 Deleted: 0 Skipped: 0 Warnings: 0\n")),(0,n.kt)("h3",{id:"error-result"},"Error result"),(0,n.kt)("p",null,"If mysql load process goes wrong, it will show the error in the client as below:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},"ERROR 1105 (HY000): errCode = 2, detailMessage = [INTERNAL_ERROR]too many filtered rows with load id b612907c-ccf4-4ac2-82fe-107ece655f0f\n")),(0,n.kt)("p",null,"If you meets this error, you can extract the ",(0,n.kt)("inlineCode",{parentName:"p"},"loadId")," and use it in the ",(0,n.kt)("inlineCode",{parentName:"p"},"show load warnings")," command to get more detail message."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"show load warnings where label='b612907c-ccf4-4ac2-82fe-107ece655f0f';\n")),(0,n.kt)("p",null,"The loadId was the label in this case."),(0,n.kt)("h3",{id:"configuration"},"Configuration"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"mysql_load_thread_pool"),": the thread pool size for singe FE node, set 4 thread by default. The block queue size is 5 times of ",(0,n.kt)("inlineCode",{parentName:"li"},"mysql_load_thread_pool"),". So FE can accept 4 + 4","*","5 = 24 requests in one time. Increase this configuration if the parallelism are larger than 24."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"mysql_load_server_secure_path"),": the secure path for load data from server. Empty path by default means that it's not allowed for server load. Recommend to create a ",(0,n.kt)("inlineCode",{parentName:"li"},"local_import_data")," directory under ",(0,n.kt)("inlineCode",{parentName:"li"},"DORIS_HOME")," to load data if you want enable it."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"mysql_load_in_memory_record")," The failed mysql load record size. The record was keep in memory and only have 20 records by default. If you want to track more records,  you can rise the config but be careful about the fe memory. This record will expired after one day and there is a async thread to clean it in every day.")),(0,n.kt)("h2",{id:"notice"},"Notice"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"If you see this ",(0,n.kt)("inlineCode",{parentName:"li"},"LOAD DATA LOCAL INFILE file request rejected due to restrictions on access")," message, you should connet mysql with ",(0,n.kt)("inlineCode",{parentName:"li"},"mysql  --local-infile=1")," command to enable client to load local file."),(0,n.kt)("li",{parentName:"ol"},"The configuration for StreamLoad will also affect MySQL Load. Such as the configurate in be named ",(0,n.kt)("inlineCode",{parentName:"li"},"streaming_load_max_mb"),", it's 10GB by default and it will control the max size for one load.")),(0,n.kt)("h2",{id:"more-help"},"More Help"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"For more detailed syntax and best practices for using MySQL Load, see the ",(0,n.kt)("a",{parentName:"li",href:"/docs/dev/sql-manual/sql-reference/Data-Manipulation-Statements/Load/MYSQL-LOAD"},"MySQL Load")," command manual.")))}m.isMDXComponent=!0}}]);