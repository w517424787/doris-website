<!doctype html>
<html lang="zh-Hans-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-1.2 plugin-docs plugin-id-default docs-doc-id-data-table/data-model">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<meta name="generator" content="Docusaurus v2.4.1">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Apache Doris RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Apache Doris Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DT7W9E9722"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DT7W9E9722",{anonymize_ip:!0})</script>






<link rel="icon" href="/zh-CN/images/logo-only.png">
<link rel="manifest" href="/zh-CN/manifest.json">
<meta name="theme-color" content="#FFFFFF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/zh-CN/img/docusaurus.png">
<link rel="mask-icon" href="/zh-CN/img/docusaurus.svg" color="rgb(37, 194, 160)">
<meta name="msapplication-TileImage" content="/zh-CN/img/docusaurus.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:500">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:400"><title data-rh="true">数据模型 - Apache Doris</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doris.apache.org/zh-CN/docs/1.2/data-table/data-model"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="1.2"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.2"><meta data-rh="true" name="docsearch:version" content="1.2"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.2"><meta data-rh="true" property="og:title" content="数据模型 - Apache Doris"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/zh-CN/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://doris.apache.org/zh-CN/docs/1.2/data-table/data-model"><link data-rh="true" rel="alternate" href="https://doris.apache.org/docs/1.2/data-table/data-model" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://doris.apache.org/zh-CN/docs/1.2/data-table/data-model" hreflang="zh-Hans-CN"><link data-rh="true" rel="alternate" href="https://doris.apache.org/docs/1.2/data-table/data-model" hreflang="x-default"><link rel="stylesheet" href="https://cdnd.selectdb.com/zh-CN/assets/css/styles.a6842d14.css">
<link rel="preload" href="https://cdnd.selectdb.com/zh-CN/assets/js/runtime~main.60411d00.js" as="script">
<link rel="preload" href="https://cdnd.selectdb.com/zh-CN/assets/js/main.055044df.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#3C2FD4;color:#FFFFFF" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="announcementBarContent_dpRF"><a href="https://github.com/apache/doris" target="_blank" style="display: flex; width: 100%; align-items: center; justify-content: center; margin-left: 4px; text-decoration: none; color: white">Do you like Apache Doris？Give us a 🌟 on GitHub 
                        <img style="width: 1.2rem; height: 1.2rem; margin-left: 0.4rem;" src="/images/github-white-icon.svg">
                    </a></div><button type="button" class="clean-btn close announcementBarClose_iXyO" aria-label="关闭"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" style="text-align:center" href="/zh-CN/">Home</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs/dev/summary/basic-summary">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/learning">Learning Path</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/docs/dev/summary/basic-summary">Getting Started</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/docs/dev/install/standard-deployment">Install and Deploy</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/docs/dev/faq/install-faq">FAQ</a></li></ul></div><a class="navbar__item navbar__link" style="text-align:center" href="/zh-CN/blog">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/community/join-community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/join-community">Join Community</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/team">Doris Team</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/how-to-contribute/">How to Contribute</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/developer-guide/debug-tool">Developer Guide</a></li></ul></div><a class="navbar__item navbar__link" style="text-align:center" href="/zh-CN/users">User Stories</a></div><div class="navbar__items navbar__items--right"><div class="versions">Version<!-- -->:<div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs/1.2/get-starting/">1.2</a><ul class="dropdown__menu"><li><a class="dropdown__link" style="text-align:center" href="/zh-CN/docs/dev/data-table/data-model">dev</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" style="text-align:center" href="/zh-CN/docs/1.2/data-table/data-model">1.2</a></li></ul></div></div><div class="locale-box"><a href="/docs/1.2/data-table/data-model" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link" style="text-align:center">EN</a><a href="/zh-CN/docs/1.2/data-table/data-model" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link dropdown__link--active" style="text-align:center">中文</a></div><a class="navbar__item navbar__link header-right-button-primary navbar-download-mobile" style="text-align:center" href="/zh-CN/download">Download</a><div class="navbar-search searchBox_ZlJk"><div class="navbar__search searchBarContainer_PzyC"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing__K5d searchBarLoadingRing_e2f0"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_m7ml"><kbd class="searchHint_zuPL">ctrl</kbd><kbd class="searchHint_zuPL">K</kbd></div></div></div><span class="github-btn desktop header-right-button-github"><span class="github-btn github-btn-large"><a class="gh-btn" href="//github.com/apache/doris/" target="_blank"><span class="gh-ico" aria-hidden="true"></span><span class="gh-text">Star</span></a><a class="gh-count" target="_blank" href="//github.com/apache/doris/stargazers/"></a></span></span><a class="header-right-button-primary navbar-download-desktop" href="/zh-CN/download">Download</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="main-wrapper docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar"><div class="doc-search"><div class="navbar__search searchBarContainer_PzyC"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing__K5d searchBarLoadingRing_e2f0"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_m7ml"><kbd class="searchHint_zuPL">ctrl</kbd><kbd class="searchHint_zuPL">K</kbd></div></div></div><a class="learning-path" href="/zh-CN/learning">Learning Path</a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/get-starting/">快速开始</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/summary/basic-summary">Doris 介绍</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/install/standard-deployment">安装部署</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh-CN/docs/1.2/data-table/data-model">数据表设计</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-CN/docs/1.2/data-table/data-model">数据模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/1.2/data-table/data-partition">数据划分</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/1.2/data-table/basic-usage">使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/1.2/data-table/hit-the-rollup">Rollup与查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/1.2/data-table/best-practice">最佳实践</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/docs/1.2/data-table/index/prefix-index">索引</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/data-operate/import/load-manual">数据操作</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/advanced/alter-table/schema-change">进阶使用</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/query-acceleration/materialized-view">查询加速</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/lakehouse/multi-catalog/">数据湖分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/ecosystem/spark-doris-connector">生态扩展</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/sql-manual/sql-functions/array-functions/array">SQL 手册</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/admin-manual/cluster-management/upgrade">管理手册</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/faq/install-faq">常见问题</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/benchmark/ssb">性能测试</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/1.2/releasenotes/release-2.0.0Alpha1">Release notes</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">数据表设计</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">数据模型</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>数据模型</h1></header><h1>数据模型</h1><p>本文档主要从逻辑层面，描述 Doris 的数据模型，以帮助用户更好的使用 Doris 应对不同的业务场景。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基本概念">基本概念<a href="#基本概念" class="hash-link" aria-label="基本概念的直接链接" title="基本概念的直接链接">​</a></h2><p>在 Doris 中，数据以表（Table）的形式进行逻辑上的描述。
一张表包括行（Row）和列（Column）。Row 即用户的一行数据。Column 用于描述一行数据中不同的字段。</p><p>Column 可以分为两大类：Key 和 Value。从业务角度看，Key 和 Value 可以分别对应维度列和指标列。</p><p>Doris 的数据模型主要分为3类:</p><ul><li>Aggregate</li><li>Unique</li><li>Duplicate</li></ul><p>下面我们分别介绍。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="aggregate-模型">Aggregate 模型<a href="#aggregate-模型" class="hash-link" aria-label="Aggregate 模型的直接链接" title="Aggregate 模型的直接链接">​</a></h2><p>我们以实际的例子来说明什么是聚合模型，以及如何正确的使用聚合模型。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例1导入数据聚合">示例1：导入数据聚合<a href="#示例1导入数据聚合" class="hash-link" aria-label="示例1：导入数据聚合的直接链接" title="示例1：导入数据聚合的直接链接">​</a></h3><p>假设业务有如下数据表模式：</p><table><thead><tr><th>ColumnName</th><th>Type</th><th>AggregationType</th><th>Comment</th></tr></thead><tbody><tr><td>user_id</td><td>LARGEINT</td><td></td><td>用户id</td></tr><tr><td>date</td><td>DATE</td><td></td><td>数据灌入日期</td></tr><tr><td>city</td><td>VARCHAR(20)</td><td></td><td>用户所在城市</td></tr><tr><td>age</td><td>SMALLINT</td><td></td><td>用户年龄</td></tr><tr><td>sex</td><td>TINYINT</td><td></td><td>用户性别</td></tr><tr><td>last_visit_date</td><td>DATETIME</td><td>REPLACE</td><td>用户最后一次访问时间</td></tr><tr><td>cost</td><td>BIGINT</td><td>SUM</td><td>用户总消费</td></tr><tr><td>max_dwell_time</td><td>INT</td><td>MAX</td><td>用户最大停留时间</td></tr><tr><td>min_dwell_time</td><td>INT</td><td>MIN</td><td>用户最小停留时间</td></tr></tbody></table><p>如果转换成建表语句则如下（省略建表语句中的 Partition 和 Distribution 信息）</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> example_db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">example_tbl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> LARGEINT </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;数据灌入日期时间&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户所在城市&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户年龄&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户性别&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">last_visit_date</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1970-01-01 00:00:00&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户最后一次访问时间&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">cost</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> SUM </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户总消费&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">max_dwell_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> MAX </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户最大停留时间&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">min_dwell_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> MIN </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;99999&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户最小停留时间&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tag.location.default: 1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到，这是一个典型的用户信息和访问行为的事实表。
在一般星型模型中，用户信息和访问行为一般分别存放在维度表和事实表中。这里我们为了更加方便的解释 Doris 的数据模型，将两部分信息统一存放在一张表中。</p><p>表中的列按照是否设置了 <code>AggregationType</code>，分为 Key (维度列) 和 Value（指标列）。没有设置 <code>AggregationType</code> 的，如 <code>user_id</code>、<code>date</code>、<code>age</code> ... 等称为 <strong>Key</strong>，而设置了 <code>AggregationType</code> 的称为 <strong>Value</strong>。</p><p>当我们导入数据时，对于 Key 列相同的行会聚合成一行，而 Value 列会按照设置的 <code>AggregationType</code> 进行聚合。 <code>AggregationType</code> 目前有以下四种聚合方式：</p><ol><li>SUM：求和，多行的 Value 进行累加。</li><li>REPLACE：替代，下一批数据中的 Value 会替换之前导入过的行中的 Value。</li><li>MAX：保留最大值。</li><li>MIN：保留最小值。</li></ol><p>假设我们有以下导入数据（原始数据）：</p><table><thead><tr><th>user_id</th><th>date</th><th>city</th><th>age</th><th>sex</th><th>last_visit_date</th><th>cost</th><th>max_dwell_time</th><th>min_dwell_time</th></tr></thead><tbody><tr><td>10000</td><td>2017-10-01</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 06:00:00</td><td>20</td><td>10</td><td>10</td></tr><tr><td>10000</td><td>2017-10-01</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 07:00:00</td><td>15</td><td>2</td><td>2</td></tr><tr><td>10001</td><td>2017-10-01</td><td>北京</td><td>30</td><td>1</td><td>2017-10-01 17:05:45</td><td>2</td><td>22</td><td>22</td></tr><tr><td>10002</td><td>2017-10-02</td><td>上海</td><td>20</td><td>1</td><td>2017-10-02 12:59:12</td><td>200</td><td>5</td><td>5</td></tr><tr><td>10003</td><td>2017-10-02</td><td>广州</td><td>32</td><td>0</td><td>2017-10-02 11:20:00</td><td>30</td><td>11</td><td>11</td></tr><tr><td>10004</td><td>2017-10-01</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-01 10:00:15</td><td>100</td><td>3</td><td>3</td></tr><tr><td>10004</td><td>2017-10-03</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-03 10:20:22</td><td>11</td><td>6</td><td>6</td></tr></tbody></table><p>我们假设这是一张记录用户访问某商品页面行为的表。我们以第一行数据为例，解释如下：</p><table><thead><tr><th>数据</th><th>说明</th></tr></thead><tbody><tr><td>10000</td><td>用户id，每个用户唯一识别id</td></tr><tr><td>2017-10-01</td><td>数据入库时间，精确到日期</td></tr><tr><td>北京</td><td>用户所在城市</td></tr><tr><td>20</td><td>用户年龄</td></tr><tr><td>0</td><td>性别男（1 代表女性）</td></tr><tr><td>2017-10-01 06:00:00</td><td>用户本次访问该页面的时间，精确到秒</td></tr><tr><td>20</td><td>用户本次访问产生的消费</td></tr><tr><td>10</td><td>用户本次访问，驻留该页面的时间</td></tr><tr><td>10</td><td>用户本次访问，驻留该页面的时间（冗余）</td></tr></tbody></table><p>那么当这批数据正确导入到 Doris 中后，Doris 中最终存储如下：</p><table><thead><tr><th>user_id</th><th>date</th><th>city</th><th>age</th><th>sex</th><th>last_visit_date</th><th>cost</th><th>max_dwell_time</th><th>min_dwell_time</th></tr></thead><tbody><tr><td>10000</td><td>2017-10-01</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 07:00:00</td><td>35</td><td>10</td><td>2</td></tr><tr><td>10001</td><td>2017-10-01</td><td>北京</td><td>30</td><td>1</td><td>2017-10-01 17:05:45</td><td>2</td><td>22</td><td>22</td></tr><tr><td>10002</td><td>2017-10-02</td><td>上海</td><td>20</td><td>1</td><td>2017-10-02 12:59:12</td><td>200</td><td>5</td><td>5</td></tr><tr><td>10003</td><td>2017-10-02</td><td>广州</td><td>32</td><td>0</td><td>2017-10-02 11:20:00</td><td>30</td><td>11</td><td>11</td></tr><tr><td>10004</td><td>2017-10-01</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-01 10:00:15</td><td>100</td><td>3</td><td>3</td></tr><tr><td>10004</td><td>2017-10-03</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-03 10:20:22</td><td>11</td><td>6</td><td>6</td></tr></tbody></table><p>可以看到，用户 10000 只剩下了一行<strong>聚合后</strong>的数据。而其余用户的数据和原始数据保持一致。这里先解释下用户 10000 聚合后的数据：</p><p>前5列没有变化，从第6列 <code>last_visit_date</code> 开始：</p><ul><li><p><code>2017-10-01 07:00:00</code>：因为 <code>last_visit_date</code> 列的聚合方式为 REPLACE，所以 <code>2017-10-01 07:00:00</code> 替换了 <code>2017-10-01 06:00:00</code> 保存了下来。</p><blockquote><p>注：在同一个导入批次中的数据，对于 REPLACE 这种聚合方式，替换顺序不做保证。如在这个例子中，最终保存下来的，也有可能是 <code>2017-10-01 06:00:00</code>。而对于不同导入批次中的数据，可以保证，后一批次的数据会替换前一批次。</p></blockquote></li><li><p><code>35</code>：因为 <code>cost</code> 列的聚合类型为 SUM，所以由 20 + 15 累加获得 35。</p></li><li><p><code>10</code>：因为 <code>max_dwell_time</code> 列的聚合类型为 MAX，所以 10 和 2 取最大值，获得 10。</p></li><li><p><code>2</code>：因为 <code>min_dwell_time</code> 列的聚合类型为 MIN，所以 10 和 2 取最小值，获得 2。</p></li></ul><p>经过聚合，Doris 中最终只会存储聚合后的数据。换句话说，即明细数据会丢失，用户不能够再查询到聚合前的明细数据了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例2保留明细数据">示例2：保留明细数据<a href="#示例2保留明细数据" class="hash-link" aria-label="示例2：保留明细数据的直接链接" title="示例2：保留明细数据的直接链接">​</a></h3><p>接示例1，我们将表结构修改如下：</p><table><thead><tr><th>ColumnName</th><th>Type</th><th>AggregationType</th><th>Comment</th></tr></thead><tbody><tr><td>user_id</td><td>LARGEINT</td><td></td><td>用户id</td></tr><tr><td>date</td><td>DATE</td><td></td><td>数据灌入日期</td></tr><tr><td>timestamp</td><td>DATETIME</td><td></td><td>数据灌入时间，精确到秒</td></tr><tr><td>city</td><td>VARCHAR(20)</td><td></td><td>用户所在城市</td></tr><tr><td>age</td><td>SMALLINT</td><td></td><td>用户年龄</td></tr><tr><td>sex</td><td>TINYINT</td><td></td><td>用户性别</td></tr><tr><td>last_visit_date</td><td>DATETIME</td><td>REPLACE</td><td>用户最后一次访问时间</td></tr><tr><td>cost</td><td>BIGINT</td><td>SUM</td><td>用户总消费</td></tr><tr><td>max_dwell_time</td><td>INT</td><td>MAX</td><td>用户最大停留时间</td></tr><tr><td>min_dwell_time</td><td>INT</td><td>MIN</td><td>用户最小停留时间</td></tr></tbody></table><p>即增加了一列 <code>timestamp</code>，记录精确到秒的数据灌入时间。
同时，将<code>AGGREGATE KEY</code>设置为<code>AGGREGATE KEY(user_id, date, timestamp, city, age, sex)</code></p><p>导入数据如下：</p><table><thead><tr><th>user_id</th><th>date</th><th>timestamp</th><th>city</th><th>age</th><th>sex</th><th>last_visit_date</th><th>cost</th><th>max_dwell_time</th><th>min_dwell_time</th></tr></thead><tbody><tr><td>10000</td><td>2017-10-01</td><td>2017-10-01 08:00:05</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 06:00:00</td><td>20</td><td>10</td><td>10</td></tr><tr><td>10000</td><td>2017-10-01</td><td>2017-10-01 09:00:05</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 07:00:00</td><td>15</td><td>2</td><td>2</td></tr><tr><td>10001</td><td>2017-10-01</td><td>2017-10-01 18:12:10</td><td>北京</td><td>30</td><td>1</td><td>2017-10-01 17:05:45</td><td>2</td><td>22</td><td>22</td></tr><tr><td>10002</td><td>2017-10-02</td><td>2017-10-02 13:10:00</td><td>上海</td><td>20</td><td>1</td><td>2017-10-02 12:59:12</td><td>200</td><td>5</td><td>5</td></tr><tr><td>10003</td><td>2017-10-02</td><td>2017-10-02 13:15:00</td><td>广州</td><td>32</td><td>0</td><td>2017-10-02 11:20:00</td><td>30</td><td>11</td><td>11</td></tr><tr><td>10004</td><td>2017-10-01</td><td>2017-10-01 12:12:48</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-01 10:00:15</td><td>100</td><td>3</td><td>3</td></tr><tr><td>10004</td><td>2017-10-03</td><td>2017-10-03 12:38:20</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-03 10:20:22</td><td>11</td><td>6</td><td>6</td></tr></tbody></table><p>那么当这批数据正确导入到 Doris 中后，Doris 中最终存储如下：</p><table><thead><tr><th>user_id</th><th>date</th><th>timestamp</th><th>city</th><th>age</th><th>sex</th><th>last_visit_date</th><th>cost</th><th>max_dwell_time</th><th>min_dwell_time</th></tr></thead><tbody><tr><td>10000</td><td>2017-10-01</td><td>2017-10-01 08:00:05</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 06:00:00</td><td>20</td><td>10</td><td>10</td></tr><tr><td>10000</td><td>2017-10-01</td><td>2017-10-01 09:00:05</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 07:00:00</td><td>15</td><td>2</td><td>2</td></tr><tr><td>10001</td><td>2017-10-01</td><td>2017-10-01 18:12:10</td><td>北京</td><td>30</td><td>1</td><td>2017-10-01 17:05:45</td><td>2</td><td>22</td><td>22</td></tr><tr><td>10002</td><td>2017-10-02</td><td>2017-10-02 13:10:00</td><td>上海</td><td>20</td><td>1</td><td>2017-10-02 12:59:12</td><td>200</td><td>5</td><td>5</td></tr><tr><td>10003</td><td>2017-10-02</td><td>2017-10-02 13:15:00</td><td>广州</td><td>32</td><td>0</td><td>2017-10-02 11:20:00</td><td>30</td><td>11</td><td>11</td></tr><tr><td>10004</td><td>2017-10-01</td><td>2017-10-01 12:12:48</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-01 10:00:15</td><td>100</td><td>3</td><td>3</td></tr><tr><td>10004</td><td>2017-10-03</td><td>2017-10-03 12:38:20</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-03 10:20:22</td><td>11</td><td>6</td><td>6</td></tr></tbody></table><p>我们可以看到，存储的数据，和导入数据完全一样，没有发生任何聚合。这是因为，这批数据中，因为加入了 <code>timestamp</code> 列，所有行的 Key 都<strong>不完全相同</strong>。也就是说，只要保证导入的数据中，每一行的 Key 都不完全相同，那么即使在聚合模型下，Doris 也可以保存完整的明细数据。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例3导入数据与已有数据聚合">示例3：导入数据与已有数据聚合<a href="#示例3导入数据与已有数据聚合" class="hash-link" aria-label="示例3：导入数据与已有数据聚合的直接链接" title="示例3：导入数据与已有数据聚合的直接链接">​</a></h3><p>接示例1。假设现在表中已有数据如下：</p><table><thead><tr><th>user_id</th><th>date</th><th>city</th><th>age</th><th>sex</th><th>last_visit_date</th><th>cost</th><th>max_dwell_time</th><th>min_dwell_time</th></tr></thead><tbody><tr><td>10000</td><td>2017-10-01</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 07:00:00</td><td>35</td><td>10</td><td>2</td></tr><tr><td>10001</td><td>2017-10-01</td><td>北京</td><td>30</td><td>1</td><td>2017-10-01 17:05:45</td><td>2</td><td>22</td><td>22</td></tr><tr><td>10002</td><td>2017-10-02</td><td>上海</td><td>20</td><td>1</td><td>2017-10-02 12:59:12</td><td>200</td><td>5</td><td>5</td></tr><tr><td>10003</td><td>2017-10-02</td><td>广州</td><td>32</td><td>0</td><td>2017-10-02 11:20:00</td><td>30</td><td>11</td><td>11</td></tr><tr><td>10004</td><td>2017-10-01</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-01 10:00:15</td><td>100</td><td>3</td><td>3</td></tr><tr><td>10004</td><td>2017-10-03</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-03 10:20:22</td><td>11</td><td>6</td><td>6</td></tr></tbody></table><p>我们再导入一批新的数据：</p><table><thead><tr><th>user_id</th><th>date</th><th>city</th><th>age</th><th>sex</th><th>last_visit_date</th><th>cost</th><th>max_dwell_time</th><th>min_dwell_time</th></tr></thead><tbody><tr><td>10004</td><td>2017-10-03</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-03 11:22:00</td><td>44</td><td>19</td><td>19</td></tr><tr><td>10005</td><td>2017-10-03</td><td>长沙</td><td>29</td><td>1</td><td>2017-10-03 18:11:02</td><td>3</td><td>1</td><td>1</td></tr></tbody></table><p>那么当这批数据正确导入到 Doris 中后，Doris 中最终存储如下：</p><table><thead><tr><th>user_id</th><th>date</th><th>city</th><th>age</th><th>sex</th><th>last_visit_date</th><th>cost</th><th>max_dwell_time</th><th>min_dwell_time</th></tr></thead><tbody><tr><td>10000</td><td>2017-10-01</td><td>北京</td><td>20</td><td>0</td><td>2017-10-01 07:00:00</td><td>35</td><td>10</td><td>2</td></tr><tr><td>10001</td><td>2017-10-01</td><td>北京</td><td>30</td><td>1</td><td>2017-10-01 17:05:45</td><td>2</td><td>22</td><td>22</td></tr><tr><td>10002</td><td>2017-10-02</td><td>上海</td><td>20</td><td>1</td><td>2017-10-02 12:59:12</td><td>200</td><td>5</td><td>5</td></tr><tr><td>10003</td><td>2017-10-02</td><td>广州</td><td>32</td><td>0</td><td>2017-10-02 11:20:00</td><td>30</td><td>11</td><td>11</td></tr><tr><td>10004</td><td>2017-10-01</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-01 10:00:15</td><td>100</td><td>3</td><td>3</td></tr><tr><td>10004</td><td>2017-10-03</td><td>深圳</td><td>35</td><td>0</td><td>2017-10-03 11:22:00</td><td>55</td><td>19</td><td>6</td></tr><tr><td>10005</td><td>2017-10-03</td><td>长沙</td><td>29</td><td>1</td><td>2017-10-03 18:11:02</td><td>3</td><td>1</td><td>1</td></tr></tbody></table><p>可以看到，用户 10004 的已有数据和新导入的数据发生了聚合。同时新增了 10005 用户的数据。</p><p>数据的聚合，在 Doris 中有如下三个阶段发生：</p><ol><li>每一批次数据导入的 ETL 阶段。该阶段会在每一批次导入的数据内部进行聚合。</li><li>底层 BE 进行数据 Compaction 的阶段。该阶段，BE 会对已导入的不同批次的数据进行进一步的聚合。</li><li>数据查询阶段。在数据查询时，对于查询涉及到的数据，会进行对应的聚合。</li></ol><p>数据在不同时间，可能聚合的程度不一致。比如一批数据刚导入时，可能还未与之前已存在的数据进行聚合。但是对于用户而言，用户<strong>只能查询到</strong>聚合后的数据。即不同的聚合程度对于用户查询而言是透明的。用户需始终认为数据以<strong>最终的完成的聚合程度</strong>存在，而<strong>不应假设某些聚合还未发生</strong>。（可参阅<strong>聚合模型的局限性</strong>一节获得更多详情。）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="unique-模型">Unique 模型<a href="#unique-模型" class="hash-link" aria-label="Unique 模型的直接链接" title="Unique 模型的直接链接">​</a></h2><p>在某些多维分析场景下，用户更关注的是如何保证 Key 的唯一性，即如何获得 Primary Key 唯一性约束。因此，我们引入了 Unique 数据模型。在1.2版本之前，该模型本质上是聚合模型的一个特例，也是一种简化的表结构表示方式。由于聚合模型的实现方式是读时合并（merge on read)，因此在一些聚合查询上性能不佳（参考后续章节<a href="#%E8%81%9A%E5%90%88%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7">聚合模型的局限性</a>的描述），在1.2版本我们引入了Unique模型新的实现方式，写时合并（merge on write），通过在写入时做一些额外的工作，实现了最优的查询性能。写时合并将在未来替换读时合并成为Unique模型的默认实现方式，两者将会短暂的共存一段时间。下面将对两种实现方式分别举例进行说明。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="读时合并与聚合模型相同的实现方式">读时合并（与聚合模型相同的实现方式）<a href="#读时合并与聚合模型相同的实现方式" class="hash-link" aria-label="读时合并（与聚合模型相同的实现方式）的直接链接" title="读时合并（与聚合模型相同的实现方式）的直接链接">​</a></h3><table><thead><tr><th>ColumnName</th><th>Type</th><th>IsKey</th><th>Comment</th></tr></thead><tbody><tr><td>user_id</td><td>BIGINT</td><td>Yes</td><td>用户id</td></tr><tr><td>username</td><td>VARCHAR(50)</td><td>Yes</td><td>用户昵称</td></tr><tr><td>city</td><td>VARCHAR(20)</td><td>No</td><td>用户所在城市</td></tr><tr><td>age</td><td>SMALLINT</td><td>No</td><td>用户年龄</td></tr><tr><td>sex</td><td>TINYINT</td><td>No</td><td>用户性别</td></tr><tr><td>phone</td><td>LARGEINT</td><td>No</td><td>用户电话</td></tr><tr><td>address</td><td>VARCHAR(500)</td><td>No</td><td>用户住址</td></tr><tr><td>register_time</td><td>DATETIME</td><td>No</td><td>用户注册时间</td></tr></tbody></table><p>这是一个典型的用户基础信息表。这类数据没有聚合需求，只需保证主键唯一性。（这里的主键为 user_id + username）。那么我们的建表语句如下：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> example_db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">example_tbl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> LARGEINT </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">username</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户昵称&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户所在城市&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户年龄&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户性别&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">phone</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> LARGEINT </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户电话&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">address</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户地址&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">register_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户注册时间&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">username</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tag.location.default: 1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而这个表结构，完全同等于以下使用聚合模型描述的表结构：</p><table><thead><tr><th>ColumnName</th><th>Type</th><th>AggregationType</th><th>Comment</th></tr></thead><tbody><tr><td>user_id</td><td>BIGINT</td><td></td><td>用户id</td></tr><tr><td>username</td><td>VARCHAR(50)</td><td></td><td>用户昵称</td></tr><tr><td>city</td><td>VARCHAR(20)</td><td>REPLACE</td><td>用户所在城市</td></tr><tr><td>age</td><td>SMALLINT</td><td>REPLACE</td><td>用户年龄</td></tr><tr><td>sex</td><td>TINYINT</td><td>REPLACE</td><td>用户性别</td></tr><tr><td>phone</td><td>LARGEINT</td><td>REPLACE</td><td>用户电话</td></tr><tr><td>address</td><td>VARCHAR(500)</td><td>REPLACE</td><td>用户住址</td></tr><tr><td>register_time</td><td>DATETIME</td><td>REPLACE</td><td>用户注册时间</td></tr></tbody></table><p>及建表语句：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> example_db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">example_tbl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> LARGEINT </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">username</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户昵称&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户所在城市&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户年龄&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户性别&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">phone</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> LARGEINT </span><span class="token keyword" style="color:#00009f">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户电话&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">address</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户地址&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">register_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户注册时间&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">username</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tag.location.default: 1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>即Unique 模型的读时合并实现完全可以用聚合模型中的 REPLACE 方式替代。其内部的实现方式和数据存储方式也完全一样。这里不再继续举例说明。</p><span class="version-mark paragraph"><span class="v-mark"><span class="version-tags"><span class="version-tag"><span class="version-tag-t">Since</span><span class="version-tag-n since">Version <!-- -->1.2</span></span></span></span><h3 class="anchor anchorWithStickyNavbar_LWe7" id="写时合并">写时合并<a href="#写时合并" class="hash-link" aria-label="写时合并的直接链接" title="写时合并的直接链接">​</a></h3><p>Unqiue模型的写时合并实现，与聚合模型就是完全不同的两种模型了，查询性能更接近于duplicate模型，在有主键约束需求的场景上相比聚合模型有较大的查询性能优势，尤其是在聚合查询以及需要用索引过滤大量数据的查询中。</p><p>在 1.2.0 版本中，作为一个新的feature，写时合并默认关闭，用户可以通过添加下面的property来开启</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;enable_unique_key_merge_on_write&quot; = &quot;true&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>仍然以上面的表为例，建表语句为</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> example_db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">example_tbl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> LARGEINT </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">username</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户昵称&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户所在城市&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户年龄&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户性别&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">phone</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> LARGEINT </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户电话&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">address</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户地址&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">register_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户注册时间&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">username</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tag.location.default: 1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;enable_unique_key_merge_on_write&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用这种建表语句建出来的表结构，与聚合模型就完全不同了：</p><table><thead><tr><th>ColumnName</th><th>Type</th><th>AggregationType</th><th>Comment</th></tr></thead><tbody><tr><td>user_id</td><td>BIGINT</td><td></td><td>用户id</td></tr><tr><td>username</td><td>VARCHAR(50)</td><td></td><td>用户昵称</td></tr><tr><td>city</td><td>VARCHAR(20)</td><td>NONE</td><td>用户所在城市</td></tr><tr><td>age</td><td>SMALLINT</td><td>NONE</td><td>用户年龄</td></tr><tr><td>sex</td><td>TINYINT</td><td>NONE</td><td>用户性别</td></tr><tr><td>phone</td><td>LARGEINT</td><td>NONE</td><td>用户电话</td></tr><tr><td>address</td><td>VARCHAR(500)</td><td>NONE</td><td>用户住址</td></tr><tr><td>register_time</td><td>DATETIME</td><td>NONE</td><td>用户注册时间</td></tr></tbody></table><p>在开启了写时合并选项的Unique表上，数据在导入阶段就会去将被覆盖和被更新的数据进行标记删除，同时将新的数据写入新的文件。在查询的时候，所有被标记删除的数据都会在文件级别被过滤掉，读取出来的数据就都是最新的数据，消除掉了读时合并中的数据聚合过程，并且能够在很多情况下支持多种谓词的下推。因此在许多场景都能带来比较大的性能提升，尤其是在有聚合查询的情况下。</p><p>【注意】</p><ol><li>新的Merge-on-write实现默认关闭，且只能在建表时通过指定property的方式打开。</li><li>旧的Merge-on-read的实现无法无缝升级到新版本的实现（数据组织方式完全不同），如果需要改为使用写时合并的实现版本，需要手动执行<code>insert into unique-mow-table select * from source table</code>.</li><li>在Unique模型上独有的delete sign 和 sequence col，在写时合并的新版实现中仍可以正常使用，用法没有变化。</li></ol></span><h2 class="anchor anchorWithStickyNavbar_LWe7" id="duplicate-模型">Duplicate 模型<a href="#duplicate-模型" class="hash-link" aria-label="Duplicate 模型的直接链接" title="Duplicate 模型的直接链接">​</a></h2><p>在某些多维分析场景下，数据既没有主键，也没有聚合需求。因此，我们引入 Duplicate 数据模型来满足这类需求。举例说明。</p><table><thead><tr><th>ColumnName</th><th>Type</th><th>SortKey</th><th>Comment</th></tr></thead><tbody><tr><td>timestamp</td><td>DATETIME</td><td>Yes</td><td>日志时间</td></tr><tr><td>type</td><td>INT</td><td>Yes</td><td>日志类型</td></tr><tr><td>error_code</td><td>INT</td><td>Yes</td><td>错误码</td></tr><tr><td>error_msg</td><td>VARCHAR(1024)</td><td>No</td><td>错误详细信息</td></tr><tr><td>op_id</td><td>BIGINT</td><td>No</td><td>负责人id</td></tr><tr><td>op_time</td><td>DATETIME</td><td>No</td><td>处理时间</td></tr></tbody></table><p>建表语句如下：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> example_db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">example_tbl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;日志时间&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">type</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;日志类型&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">error_code</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;错误码&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">error_msg</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;错误详细信息&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">op_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;负责人id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">op_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;处理时间&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">type</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">error_code</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">type</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tag.location.default: 1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这种数据模型区别于 Aggregate 和 Unique 模型。数据完全按照导入文件中的数据进行存储，不会有任何聚合。即使两行数据完全相同，也都会保留。 而在建表语句中指定的 DUPLICATE KEY，只是用来指明底层数据按照那些列进行排序。（更贴切的名称应该为 “Sorted Column”，这里取名 “DUPLICATE KEY” 只是用以明确表示所用的数据模型。关于 “Sorted Column”的更多解释，可以参阅<a href="/zh-CN/docs/1.2/data-table/index/prefix-index">前缀索引</a>）。在 DUPLICATE KEY 的选择上，我们建议适当的选择前 2-4 列就可以。</p><p>这种数据模型适用于既没有聚合需求，又没有主键唯一性约束的原始数据的存储。更多使用场景，可参阅<strong>聚合模型的局限性</strong>小节。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="聚合模型的局限性">聚合模型的局限性<a href="#聚合模型的局限性" class="hash-link" aria-label="聚合模型的局限性的直接链接" title="聚合模型的局限性的直接链接">​</a></h2><p>这里我们针对 Aggregate 模型，来介绍下聚合模型的局限性。</p><p>在聚合模型中，模型对外展现的，是<strong>最终聚合后的</strong>数据。也就是说，任何还未聚合的数据（比如说两个不同导入批次的数据），必须通过某种方式，以保证对外展示的一致性。我们举例说明。</p><p>假设表结构如下：</p><table><thead><tr><th>ColumnName</th><th>Type</th><th>AggregationType</th><th>Comment</th></tr></thead><tbody><tr><td>user_id</td><td>LARGEINT</td><td></td><td>用户id</td></tr><tr><td>date</td><td>DATE</td><td></td><td>数据灌入日期</td></tr><tr><td>cost</td><td>BIGINT</td><td>SUM</td><td>用户总消费</td></tr></tbody></table><p>假设存储引擎中有如下两个已经导入完成的批次的数据：</p><p><strong>batch 1</strong></p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>50</td></tr><tr><td>10002</td><td>2017-11-21</td><td>39</td></tr></tbody></table><p><strong>batch 2</strong></p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>1</td></tr><tr><td>10001</td><td>2017-11-21</td><td>5</td></tr><tr><td>10003</td><td>2017-11-22</td><td>22</td></tr></tbody></table><p>可以看到，用户 10001 分属在两个导入批次中的数据还没有聚合。但是为了保证用户只能查询到如下最终聚合后的数据：</p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>51</td></tr><tr><td>10001</td><td>2017-11-21</td><td>5</td></tr><tr><td>10002</td><td>2017-11-21</td><td>39</td></tr><tr><td>10003</td><td>2017-11-22</td><td>22</td></tr></tbody></table><p>我们在查询引擎中加入了聚合算子，来保证数据对外的一致性。</p><p>另外，在聚合列（Value）上，执行与聚合类型不一致的聚合类查询时，要注意语意。比如我们在如上示例中执行如下查询：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT MIN(cost) FROM table;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>得到的结果是 5，而不是 1。</p><p>同时，这种一致性保证，在某些查询中，会极大的降低查询效率。</p><p>我们以最基本的 count(*) 查询为例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT(*) FROM table;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在其他数据库中，这类查询都会很快的返回结果。因为在实现上，我们可以通过如“导入时对行进行计数，保存 count 的统计信息”，或者在查询时“仅扫描某一列数据，获得 count 值”的方式，只需很小的开销，即可获得查询结果。但是在 Doris 的聚合模型中，这种查询的开销<strong>非常大</strong>。</p><p>我们以刚才的数据为例：</p><p><strong>batch 1</strong></p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>50</td></tr><tr><td>10002</td><td>2017-11-21</td><td>39</td></tr></tbody></table><p><strong>batch 2</strong></p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>1</td></tr><tr><td>10001</td><td>2017-11-21</td><td>5</td></tr><tr><td>10003</td><td>2017-11-22</td><td>22</td></tr></tbody></table><p>因为最终的聚合结果为：</p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>51</td></tr><tr><td>10001</td><td>2017-11-21</td><td>5</td></tr><tr><td>10002</td><td>2017-11-21</td><td>39</td></tr><tr><td>10003</td><td>2017-11-22</td><td>22</td></tr></tbody></table><p>所以，<code>select count(*) from table;</code> 的正确结果应该为 <strong>4</strong>。但如果我们只扫描 <code>user_id</code> 这一列，如果加上查询时聚合，最终得到的结果是 <strong>3</strong>（10001, 10002, 10003）。而如果不加查询时聚合，则得到的结果是 <strong>5</strong>（两批次一共5行数据）。可见这两个结果都是不对的。</p><p>为了得到正确的结果，我们必须同时读取 <code>user_id</code> 和 <code>date</code> 这两列的数据，<strong>再加上查询时聚合</strong>，才能返回 <strong>4</strong> 这个正确的结果。也就是说，在 count(<em>) 查询中，Doris 必须扫描所有的 AGGREGATE KEY 列（这里就是 <code>user_id</code> 和 <code>date</code>），并且聚合后，才能得到语意正确的结果。当聚合列非常多时，count(</em>) 查询需要扫描大量的数据。</p><p>因此，当业务上有频繁的 count(*) 查询时，我们建议用户通过增加一个<strong>值恒为 1 的，聚合类型为 SUM 的列来模拟 count(<!-- -->*<!-- -->)</strong>。如刚才的例子中的表结构，我们修改如下：</p><table><thead><tr><th>ColumnName</th><th>Type</th><th>AggregateType</th><th>Comment</th></tr></thead><tbody><tr><td>user_id</td><td>BIGINT</td><td></td><td>用户id</td></tr><tr><td>date</td><td>DATE</td><td></td><td>数据灌入日期</td></tr><tr><td>cost</td><td>BIGINT</td><td>SUM</td><td>用户总消费</td></tr><tr><td>count</td><td>BIGINT</td><td>SUM</td><td>用于计算count</td></tr></tbody></table><p>增加一个 count 列，并且导入数据中，该列值<strong>恒为 1</strong>。则 <code>select count(*) from table;</code> 的结果等价于 <code>select sum(count) from table;</code>。而后者的查询效率将远高于前者。不过这种方式也有使用限制，就是用户需要自行保证，不会重复导入 AGGREGATE KEY 列都相同的行。否则，<code>select sum(count) from table;</code> 只能表述原始导入的行数，而不是 <code>select count(*) from table;</code> 的语义。</p><p>另一种方式，就是 <strong>将如上的 <code>count</code> 列的聚合类型改为 REPLACE，且依然值恒为 1</strong>。那么 <code>select sum(count) from table;</code> 和 <code>select count(*) from table;</code> 的结果将是一致的。并且这种方式，没有导入重复行的限制。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unique模型的写时合并实现">Unique模型的写时合并实现<a href="#unique模型的写时合并实现" class="hash-link" aria-label="Unique模型的写时合并实现的直接链接" title="Unique模型的写时合并实现的直接链接">​</a></h3><p>Unique模型的写时合并实现没有聚合模型的局限性，还是以刚才的数据为例，写时合并为每次导入的rowset增加了对应的delete bitmap，来标记哪些数据被覆盖。第一批数据导入后状态如下</p><p><strong>batch 1</strong></p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th><th>delete bit</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>50</td><td>false</td></tr><tr><td>10002</td><td>2017-11-21</td><td>39</td><td>false</td></tr></tbody></table><p>当第二批数据导入完成后，第一批数据中重复的行就会被标记为已删除，此时两批数据状态如下</p><p><strong>batch 1</strong></p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th><th>delete bit</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>50</td><td><strong>true</strong></td></tr><tr><td>10002</td><td>2017-11-21</td><td>39</td><td>false</td></tr></tbody></table><p><strong>batch 2</strong></p><table><thead><tr><th>user_id</th><th>date</th><th>cost</th><th>delete bit</th></tr></thead><tbody><tr><td>10001</td><td>2017-11-20</td><td>1</td><td>false</td></tr><tr><td>10001</td><td>2017-11-21</td><td>5</td><td>false</td></tr><tr><td>10003</td><td>2017-11-22</td><td>22</td><td>false</td></tr></tbody></table><p>在查询时，所有在delete bitmap中被标记删除的数据都不会读出来，因此也无需进行做任何数据聚合，上述数据中有效的行数为4行，查询出的结果也应该是4行，也就可以采取开销最小的方式来获取结果，即前面提到的“仅扫描某一列数据，获得 count 值”的方式。</p><p>在测试环境中，count(*) 查询在Unique模型的写时合并实现上的性能，相比聚合模型有10倍以上的提升。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="duplicate-模型-1">Duplicate 模型<a href="#duplicate-模型-1" class="hash-link" aria-label="Duplicate 模型的直接链接" title="Duplicate 模型的直接链接">​</a></h3><p>Duplicate 模型没有聚合模型的这个局限性。因为该模型不涉及聚合语意，在做 count(*) 查询时，任意选择一列查询，即可得到语意正确的结果。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-列">key 列<a href="#key-列" class="hash-link" aria-label="key 列的直接链接" title="key 列的直接链接">​</a></h2><p>Duplicate、Aggregate、Unique 模型，都会在建表指定 key 列，然而实际上是有所区别的：对于 Duplicate 模型，表的key列，可以认为只是 “排序列”，并非起到唯一标识的作用。而 Aggregate、Unique 模型这种聚合类型的表，key 列是兼顾 “排序列” 和 “唯一标识列”，是真正意义上的“ key 列”。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据模型的选择建议">数据模型的选择建议<a href="#数据模型的选择建议" class="hash-link" aria-label="数据模型的选择建议的直接链接" title="数据模型的选择建议的直接链接">​</a></h2><p>因为数据模型在建表时就已经确定，且<strong>无法修改</strong>。所以，选择一个合适的数据模型<strong>非常重要</strong>。</p><ol><li>Aggregate 模型可以通过预聚合，极大地降低聚合查询时所需扫描的数据量和查询的计算量，非常适合有固定模式的报表类查询场景。但是该模型对 count(*) 查询很不友好。同时因为固定了 Value 列上的聚合方式，在进行其他类型的聚合查询时，需要考虑语意正确性。</li><li>Unique 模型针对需要唯一主键约束的场景，可以保证主键唯一性约束。但是无法利用 ROLLUP 等预聚合带来的查询优势。<ol><li>对于聚合查询有较高性能需求的用户，推荐使用自1.2版本加入的写时合并实现。</li><li>Unique 模型仅支持整行更新，如果用户既需要唯一主键约束，又需要更新部分列（例如将多张源表导入到一张 doris 表的情形），则可以考虑使用 Aggregate 模型，同时将非主键列的聚合类型设置为 REPLACE_IF_NOT_NULL。具体的用法可以参考<a href="/zh-CN/docs/1.2/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-TABLE">语法手册</a></li></ol></li><li>Duplicate 适合任意维度的 Ad-hoc 查询。虽然同样无法利用预聚合的特性，但是不受聚合模型的约束，可以发挥列存模型的优势（只读取相关列，而不需要读取所有 Key 列）。</li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-CN/docs/1.2/install/source-install/compilation-mac"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">在macOS平台上编译</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-CN/docs/1.2/data-table/data-partition"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">数据划分</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基本概念" class="table-of-contents__link toc-highlight">基本概念</a></li><li><a href="#aggregate-模型" class="table-of-contents__link toc-highlight">Aggregate 模型</a><ul><li><a href="#示例1导入数据聚合" class="table-of-contents__link toc-highlight">示例1：导入数据聚合</a></li><li><a href="#示例2保留明细数据" class="table-of-contents__link toc-highlight">示例2：保留明细数据</a></li><li><a href="#示例3导入数据与已有数据聚合" class="table-of-contents__link toc-highlight">示例3：导入数据与已有数据聚合</a></li></ul></li><li><a href="#unique-模型" class="table-of-contents__link toc-highlight">Unique 模型</a><ul><li><a href="#读时合并与聚合模型相同的实现方式" class="table-of-contents__link toc-highlight">读时合并（与聚合模型相同的实现方式）</a></li><li><a href="#写时合并" class="table-of-contents__link toc-highlight">写时合并</a></li></ul></li><li><a href="#duplicate-模型" class="table-of-contents__link toc-highlight">Duplicate 模型</a></li><li><a href="#聚合模型的局限性" class="table-of-contents__link toc-highlight">聚合模型的局限性</a><ul><li><a href="#unique模型的写时合并实现" class="table-of-contents__link toc-highlight">Unique模型的写时合并实现</a></li><li><a href="#duplicate-模型-1" class="table-of-contents__link toc-highlight">Duplicate 模型</a></li></ul></li><li><a href="#key-列" class="table-of-contents__link toc-highlight">key 列</a></li><li><a href="#数据模型的选择建议" class="table-of-contents__link toc-highlight">数据模型的选择建议</a></li></ul></div></div></div></div></main></div></div></div><div class="footer"><div class="container"><div class="footer-box"><div class="left"><img src="/zh-CN/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/zh-CN/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/learning">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">Blogs</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/users">User Stories</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community Support</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/team">Doris Team</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/how-to-contribute/">How to Contribute</a></li><li class="footer__item"><a href="https://github.com/apache/doris/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/doris/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Improvement Proposal<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/doris/issues/16392" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roadmap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div class="right"><div class="footer__title">Connect with Us</div><div class="social-list"><div class="social"><a href="mailto:dev@doris.apache.org" target="_blank" title="mail" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.6003 6H26.3997C27.8186 6 28.982 7.10964 29 8.46946L16.0045 15.454L3.01202 8.47829C3.02405 7.11258 4.1784 6 5.6003 6ZM3.01202 11.1508L3 23.5011C3 24.8756 4.16938 26 5.6003 26H26.3997C27.8306 26 29 24.8756 29 23.5011V11.145L16.3111 17.8028C16.1157 17.9058 15.8813 17.9058 15.6889 17.8028L3.01202 11.1508V11.1508Z" fill="currentColor"></path></svg></a><a href="https://github.com/apache/doris" target="_blank" title="github" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.0001 2.66675C8.63342 2.66675 2.66675 8.63341 2.66675 16.0001C2.66524 18.7991 3.54517 21.5276 5.1817 23.7983C6.81824 26.0691 9.12828 27.7668 11.7841 28.6508C12.4508 28.7668 12.7001 28.3668 12.7001 28.0161C12.7001 27.7001 12.6828 26.6508 12.6828 25.5334C9.33342 26.1508 8.46675 24.7174 8.20008 23.9668C8.04942 23.5828 7.40008 22.4001 6.83342 22.0828C6.36675 21.8334 5.70008 21.2161 6.81608 21.2001C7.86675 21.1828 8.61608 22.1668 8.86675 22.5668C10.0668 24.5828 11.9841 24.0161 12.7494 23.6668C12.8668 22.8001 13.2161 22.2174 13.6001 21.8841C10.6334 21.5508 7.53342 20.4001 7.53342 15.3001C7.53342 13.8494 8.04942 12.6507 8.90008 11.7161C8.76675 11.3827 8.30008 10.0161 9.03342 8.18275C9.03342 8.18275 10.1494 7.83342 12.7001 9.55075C13.7855 9.2495 14.907 9.09787 16.0334 9.10008C17.1668 9.10008 18.3001 9.24942 19.3668 9.54942C21.9161 7.81608 23.0334 8.18408 23.0334 8.18408C23.7668 10.0174 23.3001 11.3841 23.1668 11.7174C24.0161 12.6507 24.5334 13.8334 24.5334 15.3001C24.5334 20.4174 21.4174 21.5508 18.4508 21.8841C18.9334 22.3001 19.3508 23.1001 19.3508 24.3508C19.3508 26.1334 19.3334 27.5668 19.3334 28.0174C19.3334 28.3668 19.5841 28.7828 20.2508 28.6494C22.8975 27.7558 25.1973 26.0547 26.8266 23.7856C28.4559 21.5165 29.3327 18.7936 29.3334 16.0001C29.3334 8.63341 23.3668 2.66675 16.0001 2.66675V2.66675Z" fill="currentColor"></path></svg></a><a href="https://twitter.com/doris_apache" target="_blank" title="twitter" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 3H10.6067L29 29H21.3933L3 3ZM6.31485 4.69302L22.3127 27.307H25.6852L9.68727 4.69302H6.31485Z" fill="white"></path><path d="M14.202 18.8346L5.18225 29H3L13.2092 17.4314L14.202 18.8346ZM18.4342 14.0647L28.2518 3H25.9448L17.4314 12.6471L18.4342 14.0647Z" fill="white"></path></svg></a></div><div class="social"><a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-1x7x8fger-F7NoshFQn~djlvGdnEtxUQ" title="slack" target="_blank" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_125_278)"><path d="M12.5875 16.6906C11.0844 16.6906 9.86562 17.9094 9.86562 19.4125V26.2375C9.86562 26.9594 10.1524 27.6517 10.6628 28.1622C11.1733 28.6726 11.8656 28.9594 12.5875 28.9594C13.3094 28.9594 14.0017 28.6726 14.5122 28.1622C15.0226 27.6517 15.3094 26.9594 15.3094 26.2375V19.4531C15.3094 17.9094 14.0906 16.6906 12.5875 16.6906ZM3 19.4531C3 20.175 3.28677 20.8673 3.79722 21.3778C4.30767 21.8882 4.99999 22.175 5.72187 22.175C6.44376 22.175 7.13608 21.8882 7.64653 21.3778C8.15698 20.8673 8.44375 20.175 8.44375 19.4531V16.7312H5.7625C4.25938 16.6906 3 17.9094 3 19.4531ZM12.5875 3C11.8656 3 11.1733 3.28677 10.6628 3.79722C10.1524 4.30767 9.86562 4.99999 9.86562 5.72187C9.86562 6.44376 10.1524 7.13608 10.6628 7.64653C11.1733 8.15698 11.8656 8.44375 12.5875 8.44375H15.3094V5.72187C15.3094 4.21875 14.0906 3 12.5875 3ZM5.72187 15.3094H12.5469C13.2688 15.3094 13.9611 15.0226 14.4715 14.5122C14.982 14.0017 15.2688 13.3094 15.2688 12.5875C15.2688 11.8656 14.982 11.1733 14.4715 10.6628C13.9611 10.1524 13.2688 9.86562 12.5469 9.86562H5.72187C4.99999 9.86562 4.30767 10.1524 3.79722 10.6628C3.28677 11.1733 3 11.8656 3 12.5875C3 13.3094 3.28677 14.0017 3.79722 14.5122C4.30767 15.0226 4.99999 15.3094 5.72187 15.3094ZM26.2375 9.86562C24.7344 9.86562 23.5156 11.0844 23.5156 12.5875V15.3094H26.2375C26.9594 15.3094 27.6517 15.0226 28.1622 14.5122C28.6726 14.0017 28.9594 13.3094 28.9594 12.5875C28.9594 11.8656 28.6726 11.1733 28.1622 10.6628C27.6517 10.1524 26.9594 9.86562 26.2375 9.86562ZM16.6906 5.72187V12.5875C16.6906 13.3094 16.9774 14.0017 17.4878 14.5122C17.9983 15.0226 18.6906 15.3094 19.4125 15.3094C20.1344 15.3094 20.8267 15.0226 21.3372 14.5122C21.8476 14.0017 22.1344 13.3094 22.1344 12.5875V5.72187C22.1344 4.99999 21.8476 4.30767 21.3372 3.79722C20.8267 3.28677 20.1344 3 19.4125 3C18.6906 3 17.9983 3.28677 17.4878 3.79722C16.9774 4.30767 16.6906 4.99999 16.6906 5.72187ZM22.1344 26.2781C22.1344 24.775 20.9156 23.5562 19.4125 23.5562H16.6906V26.2781C16.6906 27 16.9774 27.6923 17.4878 28.2028C17.9983 28.7132 18.6906 29 19.4125 29C20.1344 29 20.8267 28.7132 21.3372 28.2028C21.8476 27.6923 22.1344 27 22.1344 26.2781ZM26.2781 16.6906H19.4125C18.6906 16.6906 17.9983 16.9774 17.4878 17.4878C16.9774 17.9983 16.6906 18.6906 16.6906 19.4125C16.6906 20.1344 16.9774 20.8267 17.4878 21.3372C17.9983 21.8476 18.6906 22.1344 19.4125 22.1344H26.2375C27.7406 22.1344 28.9594 20.9156 28.9594 19.4125C29 17.9094 27.7812 16.6906 26.2781 16.6906Z" fill="currentColor"></path></g><defs><clipPath id="clip0_125_278"><rect width="26" height="26" fill="currentColor" transform="translate(3 3)"></rect></clipPath></defs></svg></a><a href="https://www.youtube.com/@apachedoris/channels" title="youtube" target="_blank" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_3462_1106)"><path d="M30.3048 7.66776C30.7927 8.14769 31.1465 8.74331 31.3319 9.39705C31.7949 11.91 32.0182 14.46 31.9988 17.0138C32.0164 19.558 31.7931 22.0982 31.3319 24.6017C31.1465 25.2554 30.7927 25.851 30.3048 26.3309C29.8169 26.8109 29.2115 27.1589 28.5469 27.3413C26.026 28 16.0142 28 16.0142 28C16.0142 28 5.97317 28 3.48158 27.3413C2.81702 27.1589 2.21154 26.8109 1.72366 26.3309C1.23579 25.851 0.882017 25.2554 0.696547 24.6017C0.22555 22.0991 -0.00754264 19.5589 0.000288097 17.0138C-0.00936809 14.4591 0.223732 11.9091 0.696547 9.39705C0.882017 8.74331 1.23579 8.14769 1.72366 7.66776C2.21154 7.18784 2.81702 6.83983 3.48158 6.65738C6.00118 5.9869 16.0142 6.00002 16.0142 6.00002C16.0142 6.00002 26.0526 6.00002 28.5469 6.65738C29.2115 6.83983 29.8169 7.18784 30.3048 7.66776ZM12 23L22 17.0092L12 11V23Z" fill="white"></path></g><defs><clipPath id="clip0_3462_1106"><rect width="32" height="32" fill="white"></rect></clipPath></defs></svg></a><a href="https://www.linkedin.com/company/doris-apache/" title="linkedin" target="_blank" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.29925 26.9996H9.66738V11.6781H4.29925V26.9996ZM22.1628 11.1949C19.9409 11.1949 18.7157 11.9388 17.3054 13.7407V11.6777H11.9459V26.9996H17.305V18.6738C17.305 16.9168 18.145 15.1982 20.1535 15.1982C22.162 15.1982 22.6559 16.9164 22.6559 18.632V27H28V18.2902C28 12.2386 24.3854 11.1949 22.1628 11.1949ZM6.99325 4C5.3395 4 4 5.21047 4 6.7046C4 8.19759 5.3395 9.40617 6.99325 9.40617C8.6455 9.40617 9.985 8.19722 9.985 6.7046C9.985 5.21047 8.6455 4 6.99325 4Z" fill="white"></path></svg></a></div></div></div></div><div class="footer__copyright">Copyright © 2023 The Apache Software Foundation,Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License, Version 2.0</a>. Apache, Doris, Apache Doris, the Apache feather logo and the Apache Doris logo are trademarks of The Apache Software Foundation.</div></div></div></div>
<script src="https://cdnd.selectdb.com/zh-CN/assets/js/runtime~main.60411d00.js"></script>
<script src="https://cdnd.selectdb.com/zh-CN/assets/js/main.055044df.js"></script>
</body>
</html>